±
@D:\aspdotnet\CSharpOPPsRepo\AirLines\ApiModel\AirLineApiModel.cs
	namespace 	
AirLines
 
. 
ApiModel 
{ 
public 

class 
AirLineApiModel  
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
? 
Name 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
? 
FromCity 
{  !
get" %
;% &
set' *
;* +
}, -
public		 
string		 
?		 
ToCity		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
public

 
int

 
Fare

 
{

 
get

 
;

 
set

 "
;

" #
}

$ %
} 
} àc
ED:\aspdotnet\CSharpOPPsRepo\AirLines\Controllers\AccountController.cs
	namespace		 	
AirLines		
 
.		 
Controllers		 
{

 
public 

class 
AccountController "
:# $

Controller% /
{ 
private 
readonly 
AirLineDbContext )
_context* 2
;2 3
public 
AccountController  
(  !
AirLineDbContext! 1
context2 9
)9 :
{ 	
_context 
= 
context 
; 
} 	
public 
IActionResult 
Index "
(" #
)# $
{ 	
return 
View 
( 
) 
; 
} 	
[ 	
HttpPost	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
IsEmailExsist) 6
(6 7
string7 =
email> C
)C D
{ 	
if 
( 
! 
string 
. 
IsNullOrEmpty %
(% &
email& +
)+ ,
), -
{ 
var 
finduser  
=! "
await# (
_context) 1
.1 2
user2 6
!6 7
.7 8
FirstOrDefaultAsync8 K
(K L
xL M
=>N P
xQ R
.R S
EmailS X
==Y [
email\ a
)a b
;b c
if 
( 
finduser  
!=! #
null$ (
)( )
{ 
return 
Ok !
(! "
$str" )
)) *
;* +
}   
}"" 
return## 
Ok## 
(## 
$str##  
)##  !
;##! "
}%% 	
[&& 	
HttpPost&&	 
]&& 
public'' 
IActionResult'' 
Create'' #
(''# $
User''$ (
user'') -
)''- .
{(( 	
var)) 
Isemail)) 
=)) 
_context)) !
.))! "
user))" &
!))& '
.))' (
FirstOrDefault))( 6
())6 7
u))7 8
=>))8 :
u)): ;
.)); <
Email))< A
==))A C
user))C G
.))G H
Email))H M
)))M N
;))N O
if** 
(** 
Isemail** 
!=** 
null** 
)** 
{++ 
return,, 
RedirectToAction,, '
(,,' (
nameof,,( .
(,,. /
Index,,/ 4
),,4 5
),,5 6
;,,6 7
}-- 
else.. 
{// 
_context00 
.00 
user00 
!00 
.00 
Add00 "
(00" #
user00# '
)00' (
;00( )
_context11 
.11 
SaveChanges11 $
(11$ %
)11% &
;11& '
var22 
whatrole22 
=22 
_context22 '
.22' (
role22( ,
!22, -
.22- .
FirstOrDefault22. <
(22< =
r22= >
=>22? A
r22B C
.22C D
Id22D F
==22G I
user22J N
.22N O
RoleId22O U
)22U V
;22V W
if33 
(33 
whatrole33 
!=33 
null33  $
)33$ %
{44 
	EmailSend77 
(77 
user77 "
.77" #
Email77# (
!77( )
,77) *
user77* .
.77. /
Email77/ 4
!774 5
)775 6
;776 7
if88 
(88 
whatrole88  
.88  !
Name88! %
==88& (
$str88) 0
)880 1
{99 
return:: 
Redirect:: '
(::' (
$str::( 7
)::7 8
;::8 9
};; 
else<< 
if<< 
(<< 
whatrole<< %
.<<% &
Name<<& *
==<<+ -
$str<<. 8
)<<8 9
{== 
return>> 
Redirect>> '
(>>' (
$str>>( 7
)>>7 8
;>>8 9
}@@ 
}AA 
returnBB 
RedirectToActionBB '
(BB' (
nameofBB( .
(BB. /
IndexBB/ 4
)BB4 5
)BB5 6
;BB6 7
}CC 
}EE 	
[FF 	
HttpPostFF	 
]FF 
publicGG 
asyncGG 
TaskGG 
<GG 
IActionResultGG '
>GG' (
LoginGG) .
(GG. /
stringGG/ 5
EmailGG6 ;
,GG; <
stringGG< B
passwordGGC K
)GGK L
{HH 	
varII 
IsuserII 
=II 
awaitII 
_contextII %
.II% &
userII& *
!II* +
.II+ ,
FirstOrDefaultAsyncII, ?
(II? @
uII@ A
=>IIA C
uIIC D
.IID E
EmailIIE J
==IIJ L
EmailIIL Q
&&IIR T
uIIU V
.IIV W
PasswordIIW _
==II_ a
passwordIIa i
)IIi j
;IIj k
ifJJ 
(JJ 
IsuserJJ 
!=JJ 
nullJJ 
&&JJ !
IsuserJJ" (
.JJ( )
StatusJJ) /
!=JJ/ 1
$strJJ1 :
&&JJ; =
IsuserJJ> D
.JJD E
StatusJJE K
!=JJK M
$strJJM U
)JJU V
{KK 
HttpContextLL 
.LL 
SessionLL #
.LL# $
	SetStringLL$ -
(LL- .
$strLL. 4
,LL4 5
IsuserLL6 <
.LL< =
EmailLL= B
!LLB C
)LLC D
;LLD E
varMM 
rolMM 
=MM 
_contextMM  
.MM  !
roleMM! %
!MM% &
.MM& '

FirstAsyncMM' 1
(MM1 2
rMM2 3
=>MM4 6
rMM7 8
.MM8 9
IdMM9 ;
==MM; =
IsuserMM= C
.MMC D
RoleIdMMD J
)MMJ K
.MMK L
ResultMML R
;MMR S
HttpContextNN 
.NN 
SessionNN #
.NN# $
SetInt32NN$ ,
(NN, -
$strNN- 5
,NN5 6
IsuserNN7 =
.NN= >
RoleIdNN> D
)NND E
;NNE F
HttpContextOO 
.OO 
SessionOO #
.OO# $
	SetStringOO$ -
(OO- .
$strOO. 4
,OO4 5
rolOO6 9
.OO9 :
NameOO: >
!OO> ?
)OO? @
;OO@ A
varPP 
whatrolePP 
=PP 
awaitPP #
_contextPP$ ,
.PP, -
rolePP- 1
!PP1 2
.PP2 3
FirstOrDefaultAsyncPP3 F
(PPF G
rPPG H
=>PPI K
rPPL M
.PPM N
IdPPN P
==PPQ S
IsuserPPT Z
.PPZ [
RoleIdPP[ a
)PPa b
;PPb c
ifQQ 
(QQ 
whatroleQQ 
!QQ 
.QQ 
NameQQ "
==QQ# %
$strQQ& -
)QQ- .
{RR 
returnSS 
RedirectToActionSS +
(SS+ ,
$strSS, 3
,SS3 4
$strSS5 ;
,SS; <
newSS= @
{SSA B
areaSSC G
=SSH I
$strSSJ P
}SSQ R
)SSR S
;SSS T
}TT 
elseUU 
ifUU 
(UU 
whatroleUU  
!UU  !
.UU! "
NameUU" &
==UU' )
$strUU* 4
)UU4 5
{VV 
returnWW 
RedirectToActionWW +
(WW+ ,
$strWW, 3
,WW3 4
$strWW5 ;
,WW; <
newWW= @
{WWA B
areaWWC G
=WWH I
$strWWJ P
}WWQ R
)WWR S
;WWS T
}XX 
}YY 
elseZZ 
{[[ 
ViewData\\ 
[\\ 
$str\\ '
]\\' (
=\\) *
$str\\+ @
;\\@ A
return]] 
View]] 
(]] 
)]] 
;]] 
}__ 
return`` 
View`` 
(`` 
)`` 
;`` 
}bb 	
[cc 	
HttpGetcc	 
]cc 
publicdd 
IActionResultdd 
Logindd "
(dd" #
)dd# $
{ee 	
returnff 
Viewff 
(ff 
)ff 
;ff 
}gg 	
privateoo 
staticoo 
voidoo 
	EmailSendoo %
(oo% &
stringoo& ,
tooo- /
,oo/ 0
stringoo1 7
usernameoo8 @
)oo@ A
{pp 	
stringqq 
fromqq 
=qq 
$strqq 8
;qq8 9
stringrr 
passwordrr 
=rr 
$strrr *
;rr* +
stringss 
subjectss 
=ss 
$strss 5
;ss5 6
stringtt 
bodytt 
=tt 
$"tt 
{tt 
usernamett %
}tt% &
$str	tt& Ü
"
ttÜ á
;
ttá à
tryuu 
{vv 
MailMessageww 
messageww #
=ww$ %
newww& )
MailMessageww* 5
(ww5 6
)ww6 7
;ww7 8

SmtpClientxx 
smtpxx 
=xx  !
newxx" %

SmtpClientxx& 0
(xx0 1
)xx1 2
;xx2 3
messageyy 
.yy 
Fromyy 
=yy 
newyy "
MailAddressyy# .
(yy. /
fromyy/ 3
)yy3 4
;yy4 5
messagezz 
.zz 
Tozz 
.zz 
Addzz 
(zz 
newzz "
MailAddresszz# .
(zz. /
tozz/ 1
)zz1 2
)zz2 3
;zz3 4
message{{ 
.{{ 
Subject{{ 
={{  !
subject{{" )
;{{) *
message|| 
.|| 

IsBodyHtml|| "
=||# $
true||% )
;||) *
message}} 
.}} 
Body}} 
=}} 
body}} #
;}}# $
smtp~~ 
.~~ 
Port~~ 
=~~ 
$num~~ 
;~~  
smtp 
. 
Host 
= 
$str ,
;, -
smtp
ÄÄ 
.
ÄÄ 
	EnableSsl
ÄÄ 
=
ÄÄ  
true
ÄÄ! %
;
ÄÄ% &
smtp
ÅÅ 
.
ÅÅ #
UseDefaultCredentials
ÅÅ *
=
ÅÅ+ ,
false
ÅÅ- 2
;
ÅÅ2 3
smtp
ÇÇ 
.
ÇÇ 
Credentials
ÇÇ  
=
ÇÇ! "
new
ÇÇ# &
NetworkCredential
ÇÇ' 8
(
ÇÇ8 9
from
ÇÇ9 =
,
ÇÇ= >
password
ÇÇ? G
)
ÇÇG H
;
ÇÇH I
smtp
ÉÉ 
.
ÉÉ 
DeliveryMethod
ÉÉ #
=
ÉÉ$ % 
SmtpDeliveryMethod
ÉÉ& 8
.
ÉÉ8 9
Network
ÉÉ9 @
;
ÉÉ@ A
smtp
ÑÑ 
.
ÑÑ 
Send
ÑÑ 
(
ÑÑ 
message
ÑÑ !
)
ÑÑ! "
;
ÑÑ" #
}
ÜÜ 
catch
áá 
(
áá 
	Exception
áá 
ex
áá 
)
áá  
{
àà 
Console
ââ 
.
ââ 
	WriteLine
ââ !
(
ââ! "
ex
ââ" $
.
ââ$ %
ToString
ââ% -
(
ââ- .
)
ââ. /
)
ââ/ 0
;
ââ0 1
}
ää 
}
åå 	
[
éé 	
AllowAnonymous
éé	 
]
éé 
[
èè 	
HttpGet
èè	 
]
èè 
public
êê 
IActionResult
êê 
Logout
êê #
(
êê# $
)
êê$ %
{
ëë 	
HttpContext
íí 
.
íí 
Session
íí 
.
íí  
Clear
íí  %
(
íí% &
)
íí& '
;
íí' (
return
ìì 
RedirectToAction
ìì #
(
ìì# $
nameof
ìì$ *
(
ìì* +
Login
ìì+ 0
)
ìì0 1
)
ìì1 2
;
ìì2 3
}
ïï 	
public
ññ 
IActionResult
ññ 
	ErrorPage
ññ &
(
ññ& '
)
ññ' (
{
óó 	
return
òò 
View
òò 
(
òò 
)
òò 
;
òò 
}
ôô 	
}
ùù 
}ûû ¯#
CD:\aspdotnet\CSharpOPPsRepo\AirLines\Controllers\AdminController.cs
	namespace 	
AirLines
 
. 
Controllers 
{ 
public 

class 
AdminController  
:! "

Controller# -
{ 
private 
readonly 
AirLineDbContext )
_context* 2
;2 3
public 
AdminController 
( 
AirLineDbContext /
context0 7
)7 8
{ 	
_context 
= 
context 
; 
} 	
[ 	
CustomAuthorize	 
( 
$str  
)  !
]! "
public 
async 
Task 
< 
IActionResult '
>' (
Index) .
(. /
)/ 0
{ 	
ViewData 
[ 
$str 
]  
=! "
HttpContext# .
.. /
Session/ 6
.6 7
	GetString7 @
(@ A
$strA G
)G H
;H I
return 
_context 
. 
user "
!=# %
null& *
?+ ,
View   
(   
await   $
_context  % -
.  - .
user  . 2
.  2 3
Where  3 8
(  8 9
u  9 :
=>  : <
u  < =
.  = >
Status  > D
==  D F
$str  F O
)  O P
.  P Q
ToListAsync  Q \
(  \ ]
)  ] ^
)  ^ _
:  ` a
Problem!! !
(!!! "
$str!!" O
)!!O P
;!!P Q
}"" 	
[## 	
CustomAuthorize##	 
(## 
$str##  
)##  !
]##! "
[$$ 	
HttpPost$$	 
]$$ 
public%% 
async%% 
Task%% 
<%% 
IActionResult%% '
>%%' (
Edit%%) -
(%%- .
string%%. 4
email%%5 :
,%%: ;
string%%; A
status%%B H
)%%H I
{&& 	
if)) 
()) 
!)) 
string)) 
.)) 
IsNullOrWhiteSpace)) *
())* +
email))+ 0
)))0 1
)))1 2
{** 
try++ 
{,, 
var-- 
finduser--  
=--! "
await--# (
_context--) 1
.--1 2
user--2 6
!--6 7
.--7 8
FirstOrDefaultAsync--8 K
(--K L
u--L M
=>--N P
u--Q R
.--R S
Email--S X
==--X Z
email--Z _
)--_ `
;--` a
finduser.. 
!.. 
... 
Status.. $
=..% &
status..' -
;..- .
_context// 
.// 
user// !
!//! "
.//" #
Update//# )
(//) *
finduser//* 2
)//2 3
;//3 4
await00 
_context00 !
.00! "
SaveChangesAsync00" 2
(002 3
)003 4
;004 5
return11 
RedirectToAction11 +
(11+ ,
nameof11, 2
(112 3
Index113 8
)118 9
)119 :
;11: ;
}22 
catch33 
(33 (
DbUpdateConcurrencyException33 3
)333 4
{44 
if55 
(55 
!55 

UserExists55 #
(55# $
email55$ )
)55) *
)55* +
{66 
return77 
NotFound77 '
(77' (
)77( )
;77) *
}88 
else99 
{:: 
throw;; 
;;; 
}<< 
}== 
}?? 
return@@ 
RedirectToAction@@ #
(@@# $
nameof@@$ *
(@@* +
Index@@+ 0
)@@0 1
)@@1 2
;@@2 3
}AA 	
privateCC 
boolCC 

UserExistsCC 
(CC  
stringCC  &
idCC' )
)CC) *
{DD 	
returnEE
 
(EE 
_contextEE 
.EE 
userEE 
?EE  
.EE  !
AnyEE! $
(EE$ %
eEE% &
=>EE' )
eEE* +
.EE+ ,
EmailEE, 1
==EE2 4
idEE5 7
)EE7 8
)EE8 9
.EE9 :
GetValueOrDefaultEE: K
(EEK L
)EEL M
;EEM N
}FF 	
}GG 
}HH À
BD:\aspdotnet\CSharpOPPsRepo\AirLines\Controllers\HomeController.cs
	namespace 	
AirLines
 
. 
Controllers 
{		 
public 

class 
HomeController 
:  !

Controller" ,
{ 
public 
IActionResult 
Index "
(" #
)# $
{ 	
ViewData 
[ 
$str 
]  
=! "
HttpContext# .
.. /
Session/ 6
.6 7
	GetString7 @
(@ A
$strA G
)G H
;H I
return 
View 
( 
) 
; 
} 	
[ 	
ResponseCache	 
( 
Duration 
=  !
$num" #
,# $
Location% -
=. /!
ResponseCacheLocation0 E
.E F
NoneF J
,J K
NoStoreL S
=T U
trueV Z
)Z [
][ \
public 
IActionResult 
Error "
(" #
)# $
{ 	
return 
View 
( 
new 
ErrorViewModel *
{+ ,
	RequestId- 6
=7 8
Activity9 A
.A B
CurrentB I
?I J
.J K
IdK M
??N P
HttpContextQ \
.\ ]
TraceIdentifier] l
}m n
)n o
;o p
} 	
} 
} ‘1
FD:\aspdotnet\CSharpOPPsRepo\AirLines\Controllers\OperatorController.cs
	namespace 	
AirLines
 
. 
Controllers 
{ 
public 

class 
OperatorController #
:$ %

Controller& 0
{ 
private 
readonly 
DataServisce %
_context& .
;. /
[ 	
CustomAuthorize	 
( 
$str #
)# $
]$ %
public 
OperatorController !
(! "
DataServisce" .
context/ 6
)6 7
{ 	
_context 
= 
context 
; 
} 	
[ 	
CustomAuthorize	 
( 
$str #
)# $
]$ %
public 
IActionResult 
Index "
(" #
)# $
{ 	
ViewData 
[ 
$str 
]  
=! "
HttpContext# .
.. /
Session/ 6
.6 7
	GetString7 @
(@ A
$strA G
)G H
;H I
return 
View 
( 
_context !
.! "
GetAirlines" -
(- .
). /
)/ 0
;0 1
}   	
public$$ 
IActionResult$$ 
Create$$ #
($$# $
)$$$ %
{%% 	
ViewData&& 
[&& 
$str&& 
]&&  
=&&! "
HttpContext&&# .
.&&. /
Session&&/ 6
.&&6 7
	GetString&&7 @
(&&@ A
$str&&A G
)&&G H
;&&H I
return'' 
View'' 
('' 
)'' 
;'' 
}(( 	
[)) 	
CustomAuthorize))	 
()) 
$str)) #
)))# $
]))$ %
[** 	
HttpPost**	 
]** 
[++ 	$
ValidateAntiForgeryToken++	 !
]++! "
public,, 
IActionResult,, 
Create,, #
(,,# $
[,,$ %
Bind,,% )
(,,) *
$str,,* H
),,H I
],,I J
AirlineViewModel,,K [
airlineViewModel,,\ l
),,l m
{-- 	
if.. 
(.. 

ModelState.. 
... 
IsValid.. "
).." #
{// 
_context11 
.11 
AddAirLines11 $
(11$ %
airlineViewModel11% 5
)115 6
;116 7
return22 
RedirectToAction22 '
(22' (
nameof22( .
(22. /
Index22/ 4
)224 5
)225 6
;226 7
}33 
ViewData44 
[44 
$str44 
]44  
=44! "
HttpContext44# .
.44. /
Session44/ 6
.446 7
	GetString447 @
(44@ A
$str44A G
)44G H
;44H I
return55 
View55 
(55 
airlineViewModel55 (
)55( )
;55) *
}66 	
[99 	
CustomAuthorize99	 
(99 
$str99 #
)99# $
]99$ %
public:: 
IActionResult:: 
Edit:: !
(::! "
int::" %
?::% &
id::' )
)::) *
{;; 	
if<< 
(<< 
id<< 
==<< 
null<< 
||<< 
_context<< &
.<<& '
GetAirlines<<' 2
==<<3 5
null<<6 :
)<<: ;
{== 
return>> 
NotFound>> 
(>>  
)>>  !
;>>! "
}?? 
varAA 
airlineViewModelAA  
=AA! "
_contextAA# +
.AA+ ,
GetByIdAA, 3
(AA3 4
idAA4 6
)AA6 7
;AA7 8
ifBB 
(BB 
airlineViewModelBB  
==BB! #
nullBB$ (
)BB( )
{CC 
returnDD 
NotFoundDD 
(DD  
)DD  !
;DD! "
}EE 
ViewDataFF 
[FF 
$strFF 
]FF  
=FF! "
HttpContextFF# .
.FF. /
SessionFF/ 6
.FF6 7
	GetStringFF7 @
(FF@ A
$strFFA G
)FFG H
;FFH I
returnGG 
ViewGG 
(GG 
airlineViewModelGG (
)GG( )
;GG) *
}HH 	
[II 	
CustomAuthorizeII	 
(II 
$strII #
)II# $
]II$ %
[JJ 	
HttpPostJJ	 
]JJ 
[KK 	$
ValidateAntiForgeryTokenKK	 !
]KK! "
publicLL 
IActionResultLL 
EditLL !
(LL! "
[LL" #
BindLL# '
(LL' (
$strLL( F
)LLF G
]LLG H
AirlineViewModelLLI Y
airlineViewModelLLZ j
)LLj k
{MM 	
ifOO 
(OO 

ModelStateOO 
.OO 
IsValidOO "
)OO" #
{PP 
tryQQ 
{RR 
_contextSS 
.SS 
UpdateSS #
(SS# $
airlineViewModelSS$ 4
)SS4 5
;SS5 6
}UU 
catchVV 
(VV (
DbUpdateConcurrencyExceptionVV 3
)VV3 4
{WW 
returnXX 
ViewXX 
(XX  
)XX  !
;XX! "
}YY 
ViewDataZZ 
[ZZ 
$strZZ #
]ZZ# $
=ZZ% &
HttpContextZZ' 2
.ZZ2 3
SessionZZ3 :
.ZZ: ;
	GetStringZZ; D
(ZZD E
$strZZE K
)ZZK L
;ZZL M
return[[ 
RedirectToAction[[ '
([[' (
nameof[[( .
([[. /
Index[[/ 4
)[[4 5
)[[5 6
;[[6 7
}\\ 
ViewData]] 
[]] 
$str]] 
]]]  
=]]! "
HttpContext]]# .
.]]. /
Session]]/ 6
.]]6 7
	GetString]]7 @
(]]@ A
$str]]A G
)]]G H
;]]H I
return^^ 
View^^ 
(^^ 
airlineViewModel^^ (
)^^( )
;^^) *
}__ 	
}dd 
}ee û
QD:\aspdotnet\CSharpOPPsRepo\AirLines\customMiddleware\CustomAuthorizeAttribute.cs
	namespace 	
AirLines
 
. 
customMiddleware #
{ 
[ 
AttributeUsage 
( 
AttributeTargets $
.$ %
Method% +
|, -
AttributeTargets. >
.> ?
Enum? C
|D E
AttributeTargetsF V
.V W
	InterfaceW `
|a b
AttributeTargetsc s
.s t
Delegatet |
|| }
AttributeTargets	~ é
.
é è
All
è í
)
í ì
]
ì î
public 

class $
CustomAuthorizeAttribute )
:* +
	Attribute, 5
,5 6 
IAuthorizationFilter7 K
{		 
private

 
readonly

 
string

  
allowedroles

! -
;

- .
public $
CustomAuthorizeAttribute '
(' (
string( .
roles/ 4
)4 5
{ 	
this 
. 
allowedroles 
= 
roles  %
;% &
} 	
public 
void 
OnAuthorization #
(# $&
AuthorizationFilterContext$ >
httpcontext? J
)J K
{ 	
if 
( 
string 
. 
IsNullOrWhiteSpace )
() *
httpcontext* 5
.5 6
HttpContext6 A
.A B
SessionB I
.I J
	GetStringJ S
(S T
$strT Z
)Z [
)[ \
)\ ]
{ 
httpcontext 
. 
HttpContext '
.' (
Response( 0
.0 1
Redirect1 9
(9 :
$str: I
)I J
;J K
} 
else 
{ 
var   
role   
=   
httpcontext   &
.  & '
HttpContext  ' 2
.  2 3
Session  3 :
.  : ;
	GetString  ; D
(  D E
$str  E K
)  K L
;  L M
if"" 
("" 
role"" 
!="" 
null""  
)""  !
{## 
if$$ 
($$ 
allowedroles$$ $
==$$% '
role$$( ,
)$$, -
{%% 
if&& 
(&& 
allowedroles&& (
==&&) +
$str&&, 3
&&&&4 6
role&&7 ;
==&&< >
$str&&? F
)&&F G
{'' 
}** 
else++ 
if++ 
(++  !
allowedroles++! -
==++. 0
$str++1 ;
&&++< >
role++? C
==++D F
$str++G Q
)++Q R
{,, 
}.. 
}// 
else00 
{11 
httpcontext22 #
.22# $
HttpContext22$ /
.22/ 0
Response220 8
.228 9
Redirect229 A
(22A B
$str22B U
)22U V
;22V W
}44 
}77 
else88 
{99 
httpcontext:: 
.::  
HttpContext::  +
.::+ ,
Response::, 4
.::4 5
Redirect::5 =
(::= >
$str::> M
)::M N
;::N O
};; 
}<< 
}?? 	
}@@ 
}AA è
=D:\aspdotnet\CSharpOPPsRepo\AirLines\Data\AirLineDbContext.cs
	namespace 	
AirLines
 
. 
Data 
{ 
public 

class 
AirLineDbContext !
:! "
	DbContext" +
{ 
public 
DbSet 
< 
User 
> 
? 
user  
{! "
get# &
;& '
set( +
;+ ,
}- .
public		 
DbSet		 
<		 
Role		 
>		 
?		 
role		  
{		! "
get		# &
;		& '
set		( +
;		+ ,
}		- .
public

 
AirLineDbContext

 
(

  
DbContextOptions

  0
options

1 8
)

8 9
:

9 :
base

: >
(

> ?
options

? F
)

F G
{

G H
}

H I
public 
AirLineDbContext 
(  
)  !
{ 	
} 	
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
builder= D
)D E
{ 	
builder 
. 
Entity 
< 
User 
>  
(  !
)! "
." #
HasIndex# +
(+ ,
u, -
=>- /
u/ 0
.0 1
Email1 6
)6 7
.7 8
IsUnique8 @
(@ A
)A B
;B C
builder 
. 
Entity 
< 
Role 
>  
(  !
)! "
." #
HasIndex# +
(+ ,
r, -
=>- /
r/ 0
.0 1
Name1 5
)5 6
.6 7
IsUnique7 ?
(? @
)@ A
;A B
} 	
public 
DbSet 
< 
AirLines 
. 
Models $
.$ %
AirlineViewModel% 5
>5 6
?6 7
AirlineViewModel8 H
{I J
getK N
;N O
setP S
;S T
}U V
} 
} ’1
WD:\aspdotnet\CSharpOPPsRepo\AirLines\Data\Migrations\20220824014338_initialmigration.cs
	namespace 	
AirLines
 
. 
Data 
. 

Migrations "
{ 
public 

partial 
class 
initialmigration )
:* +
	Migration, 5
{ 
	protected		 
override		 
void		 
Up		  "
(		" #
MigrationBuilder		# 3
migrationBuilder		4 D
)		D E
{

 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 E
,E F
nullableG O
:O P
falseQ V
)V W
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% .
,. /
x0 1
=>2 4
x5 6
.6 7
Id7 9
)9 :
;: ;
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
Email 
= 
table !
.! "
Column" (
<( )
string) /
>/ 0
(0 1
type1 5
:5 6
$str7 E
,E F
	maxLengthG P
:P Q
$numR T
,T U
nullableV ^
:^ _
false` e
)e f
,f g
	PanNumber 
= 
table  %
.% &
Column& ,
<, -
int- 0
>0 1
(1 2
type2 6
:6 7
$str8 =
,= >
	maxLength? H
:H I
$numJ L
,L M
nullableN V
:V W
falseX ]
)] ^
,^ _
Password   
=   
table   $
.  $ %
Column  % +
<  + ,
string  , 2
>  2 3
(  3 4
type  4 8
:  8 9
$str  : H
,  H I
	maxLength  J S
:  S T
$num  U W
,  W X
nullable  Y a
:  a b
false  c h
)  h i
,  i j
ConfirmPassword!! #
=!!$ %
table!!& +
.!!+ ,
Column!!, 2
<!!2 3
string!!3 9
>!!9 :
(!!: ;
type!!; ?
:!!? @
$str!!A O
,!!O P
	maxLength!!Q Z
:!!Z [
$num!!\ ^
,!!^ _
nullable!!` h
:!!h i
false!!j o
)!!o p
,!!p q
Status"" 
="" 
table"" "
.""" #
Column""# )
<"") *
string""* 0
>""0 1
(""1 2
type""2 6
:""6 7
$str""8 G
,""G H
nullable""I Q
:""Q R
false""S X
)""X Y
,""Y Z
RoleId## 
=## 
table## "
.##" #
Column### )
<##) *
int##* -
>##- .
(##. /
type##/ 3
:##3 4
$str##5 :
,##: ;
nullable##< D
:##D E
false##F K
)##K L
}$$ 
,$$ 
constraints%% 
:%% 
table%% "
=>%%# %
{&& 
table'' 
.'' 

PrimaryKey'' $
(''$ %
$str''% .
,''. /
x''0 1
=>''2 4
x''5 6
.''6 7
Id''7 9
)''9 :
;'': ;
}(( 
)(( 
;(( 
migrationBuilder** 
.** 
CreateIndex** (
(**( )
name++ 
:++ 
$str++ $
,++$ %
table,, 
:,, 
$str,, 
,,, 
column-- 
:-- 
$str-- 
,-- 
unique.. 
:.. 
true.. 
).. 
;.. 
migrationBuilder00 
.00 
CreateIndex00 (
(00( )
name11 
:11 
$str11 %
,11% &
table22 
:22 
$str22 
,22 
column33 
:33 
$str33 
,33  
unique44 
:44 
true44 
)44 
;44 
}55 	
	protected77 
override77 
void77 
Down77  $
(77$ %
MigrationBuilder77% 5
migrationBuilder776 F
)77F G
{88 	
migrationBuilder99 
.99 
	DropTable99 &
(99& '
name:: 
::: 
$str:: 
):: 
;:: 
migrationBuilder<< 
.<< 
	DropTable<< &
(<<& '
name== 
:== 
$str== 
)== 
;== 
}>> 	
}?? 
}@@ ¸
ZD:\aspdotnet\CSharpOPPsRepo\AirLines\Data\Migrations\20220824035049_initialmigrationtwo.cs
	namespace 	
AirLines
 
. 
Data 
. 

Migrations "
{ 
public 

partial 
class 
initialmigrationtwo ,
:- .
	Migration/ 8
{ 
	protected		 
override		 
void		 
Up		  "
(		" #
MigrationBuilder		# 3
migrationBuilder		4 D
)		D E
{

 	
migrationBuilder 
. 
AlterColumn (
<( )
long) -
>- .
(. /
name 
: 
$str !
,! "
table 
: 
$str 
, 
type 
: 
$str 
, 
	maxLength 
: 
$num 
, 
nullable 
: 
false 
,  

oldClrType 
: 
typeof "
(" #
int# &
)& '
,' (
oldType 
: 
$str 
, 
oldMaxLength 
: 
$num  
)  !
;! "
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 
AlterColumn (
<( )
int) ,
>, -
(- .
name 
: 
$str !
,! "
table 
: 
$str 
, 
type 
: 
$str 
, 
	maxLength 
: 
$num 
, 
nullable 
: 
false 
,  

oldClrType 
: 
typeof "
(" #
long# '
)' (
,( )
oldType 
: 
$str !
,! "
oldMaxLength   
:   
$num    
)    !
;  ! "
}!! 	
}"" 
}## Ü
\D:\aspdotnet\CSharpOPPsRepo\AirLines\Data\Migrations\20220824035317_initialmigrationthree.cs
	namespace 	
AirLines
 
. 
Data 
. 

Migrations "
{ 
public 

partial 
class !
initialmigrationthree .
:/ 0
	Migration1 :
{ 
	protected		 
override		 
void		 
Up		  "
(		" #
MigrationBuilder		# 3
migrationBuilder		4 D
)		D E
{

 	
migrationBuilder 
. 
AlterColumn (
<( )
string) /
>/ 0
(0 1
name 
: 
$str !
,! "
table 
: 
$str 
, 
type 
: 
$str $
,$ %
	maxLength 
: 
$num 
, 
nullable 
: 
false 
,  

oldClrType 
: 
typeof "
(" #
long# '
)' (
,( )
oldType 
: 
$str !
,! "
oldMaxLength 
: 
$num  
)  !
;! "
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 
AlterColumn (
<( )
long) -
>- .
(. /
name 
: 
$str !
,! "
table 
: 
$str 
, 
type 
: 
$str 
, 
	maxLength 
: 
$num 
, 
nullable 
: 
false 
,  

oldClrType 
: 
typeof "
(" #
string# )
)) *
,* +
oldType 
: 
$str '
,' (
oldMaxLength   
:   
$num    
)    !
;  ! "
}!! 	
}"" 
}## Ü
<D:\aspdotnet\CSharpOPPsRepo\AirLines\Mapper\MapperProfile.cs
	namespace 	
AirLines
 
. 
Mapper 
{ 
public 

class 
MapperProfile 
: 
Profile &
{ 
public		 
MapperProfile		 
(		 
)		 
{

 	
	CreateMap 
< 
AirLineApiModel %
,% &
AirlineViewModel' 7
>7 8
(8 9
)9 :
.: ;

ReverseMap; E
(E F
)F G
;G H
} 	
} 
} ‰
?D:\aspdotnet\CSharpOPPsRepo\AirLines\Models\AirlineViewModel.cs
	namespace 	
AirLines
 
. 
Models 
{ 
public 

class 
AirlineViewModel !
{ 
[ 	
DatabaseGenerated	 
( #
DatabaseGeneratedOption 2
.2 3
Identity3 ;
); <
]< =
[		 	
Key			 
]		 
public

 
int

 
Id

 
{

 
get

 
;

 
set

  
;

  !
}

" #
[ 	
Required	 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
public 
string 
? 
Name 
{ 
get !
;! "
set# &
;& '
}( )
[ 	
Required	 
, 
	MaxLength 
( 
$num 
)  
]  !
public 
string 
? 
FromCity 
{  !
get" %
;% &
set' *
;* +
}, -
[ 	
Required	 
, 
	MaxLength 
( 
$num 
)  
]  !
public 
string 
? 
ToCity 
{ 
get  #
;# $
set% (
;( )
}* +
[ 	
Required	 
] 
public 
int 
Fare 
{ 
get 
; 
set "
;" #
}$ %
} 
} ñ
=D:\aspdotnet\CSharpOPPsRepo\AirLines\Models\ErrorViewModel.cs
	namespace 	
AirLines
 
. 
Models 
{ 
public 

class 
ErrorViewModel 
{ 
public 
string 
? 
	RequestId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
bool 
ShowRequestId !
=>" $
!% &
string& ,
., -
IsNullOrEmpty- :
(: ;
	RequestId; D
)D E
;E F
} 
}		 ∂
3D:\aspdotnet\CSharpOPPsRepo\AirLines\Models\Role.cs
	namespace 	
AirLines
 
. 
Models 
{ 
public 

class 
Role 
{ 
[ 	
DatabaseGenerated	 
( #
DatabaseGeneratedOption 2
.2 3
Identity3 ;
); <
]< =
[		 	
Key			 
]		 
public

 
int

 
Id

 
{

 
get

 
;

 
set

  
;

  !
}

" #
[ 	
Required	 
] 
public 
string 
? 
Name 
{ 
get !
;! "
set# &
;& '
}( )
} 
} Ç
3D:\aspdotnet\CSharpOPPsRepo\AirLines\Models\User.cs
	namespace 	
AirLines
 
. 
Models 
{ 
public 

class 
User 
{ 
[		 	
DatabaseGenerated			 
(		 #
DatabaseGeneratedOption		 2
.		2 3
Identity		3 ;
)		; <
]		< =
[

 	
Key

	 
]

 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[ 	
Required	 
, 
	MaxLength 
( 
$num 
) 
,  
DataType  (
(( )
DataType) 1
.1 2
EmailAddress2 >
)> ?
]? @
public 
string 
? 
Email 
{ 
get "
;" #
set$ '
;' (
}) *
[ 	
Required	 
, 
	MaxLength 
( 
$num 
) 
,  
	MinLength  )
() *
$num* ,
), -
,- .
DataType. 6
(6 7
DataType7 ?
.? @

PostalCode@ J
)J K
]K L
public 
string 
? 
	PanNumber !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	
Required	 
, 
	MinLength 
( 
$num 
) 
, 
	MaxLength (
(( )
$num) +
)+ ,
,, -
DataType- 5
(5 6
DataType6 >
.> ?
Password? G
)G H
]H I
public 
string 
? 
Password 
{  !
get" %
;% &
set' *
;* +
}, -
[ 	
Required	 
, 
	MinLength 
( 
$num 
) 
,  
	MaxLength! *
(* +
$num+ -
)- .
,. /
DataType0 8
(8 9
DataType9 A
.A B
PasswordB J
)J K
]K L
public 
string 
? 
ConfirmPassword &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
[ 	
Required	 
] 
public 
string 
? 
Status 
{ 
get  #
;# $
set% (
;( )
}* +
[ 	
Required	 
] 
public 
int 
RoleId 
{ 
get 
;  
set! $
;$ %
}& '
public 
User 
( 
) 
{ 	
Status 
= 
$str 
; 
} 	
} 
} ˝
/D:\aspdotnet\CSharpOPPsRepo\AirLines\Program.cs
var		 
builder		 
=		 
WebApplication		 
.		 
CreateBuilder		 *
(		* +
args		+ /
)		/ 0
;		0 1
builder 
. 
Services 
. 
AddDbContext 
< 
AirLineDbContext .
>. /
(/ 0
option0 6
=>7 9
option: @
.@ A
UseSqlServerA M
(M N
builderN U
.U V
ConfigurationV c
.c d
GetConnectionStringd w
(w x
$str	x Ñ
)
Ñ Ö
??
Ü à
throw
â é
new
è í'
InvalidOperationException
ì ¨
(
¨ ≠
$str
≠ À
)
À Ã
)
Ã Õ
)
Õ Œ
;
Œ œ
builder 
. 
Services 
. 
AddAutoMapper 
( 
typeof %
(% &
Program& -
)- .
). /
;/ 0
builder 
. 
Services 
. 
	AddScoped 
< 
DataServisce '
>' (
(( )
)) *
;* +
builder 
. 
Services 
. #
AddControllersWithViews (
(( )
)) *
;* +
builder 
. 
Services 
. %
AddDistributedMemoryCache *
(* +
)+ ,
;, -
builder 
. 
Services 
. 

AddSession 
( 
options #
=>$ &
{ 
options 
. 
IdleTimeout 
= 
TimeSpan "
." #
FromMinutes# .
(. /
$num/ 1
)1 2
;2 3
options 
. 
Cookie 
. 
HttpOnly 
= 
true "
;" #
options 
. 
Cookie 
. 
IsEssential 
=  
true! %
;% &
} 
) 
; 
var 
app 
= 	
builder
 
. 
Build 
( 
) 
; 
if 
( 
! 
app 
. 	
Environment	 
. 
IsDevelopment "
(" #
)# $
)$ %
{ 
app 
. 
UseExceptionHandler 
( 
$str )
)) *
;* +
app!! 
.!! 
UseHsts!! 
(!! 
)!! 
;!! 
}"" 
app$$ 
.$$ 
UseHttpsRedirection$$ 
($$ 
)$$ 
;$$ 
app%% 
.%% 
UseStaticFiles%% 
(%% 
)%% 
;%% 
app'' 
.'' 

UseRouting'' 
('' 
)'' 
;'' 
app)) 
.)) 
UseAuthorization)) 
()) 
))) 
;)) 
app** 
.** 

UseSession** 
(** 
)** 
;** 
app++ 
.++ 
MapControllerRoute++ 
(++ 
name,, 
:,, 	
$str,,
 
,,, 
pattern-- 
:-- 
$str-- 5
)--5 6
;--6 7
app// 
.// 
Run// 
(// 
)// 	
;//	 
¡7
=D:\aspdotnet\CSharpOPPsRepo\AirLines\Services\DataServisce.cs
	namespace 	
AirLines
 
. 
Services 
{		 
public

 

class

 
DataServisce

 
{ 
readonly 
Uri 
baseAddress  
=! "
new# &
Uri' *
(* +
$str+ D
)D E
;E F
readonly 

HttpClient 

httpClient %
=& '
new( +

HttpClient, 6
(6 7
)7 8
;8 9
private 
readonly 
IMapper  
_mapper! (
;( )
public 
DataServisce 
( 
IMapper #
mapper$ *
)* +
{ 	
_mapper 
= 
mapper 
; 

httpClient 
. 
BaseAddress "
=# $
baseAddress% 0
;0 1
} 	
public 
List 
< 
AirlineViewModel $
>$ %
GetAirlines& 1
(1 2
)2 3
{ 	
HttpResponseMessage 
Response  (
=) *

httpClient+ 5
.5 6
GetAsync6 >
(> ?
baseAddress? J
+K L
$strM f
)f g
.g h
Resulth n
;n o
if 
( 
Response 
. 
IsSuccessStatusCode ,
), -
{ 
string 
data 
= 
Response &
.& '
Content' .
.. /
ReadAsStringAsync/ @
(@ A
)A B
.B C
ResultC I
;I J
var 
list 
= 
JsonConvert &
.& '
DeserializeObject' 8
<8 9
List9 =
<= >
AirLineApiModel> M
>M N
>N O
(O P
dataP T
)T U
;U V
var 
airlines 
= 
_mapper &
.& '
Map' *
<* +
List+ /
</ 0
AirlineViewModel0 @
>@ A
>A B
(B C
listC G
)G H
;H I
return 
airlines 
;  
} 
return!! 
new!! 
List!! 
<!! 
AirlineViewModel!! ,
>!!, -
(!!- .
)!!. /
;!!/ 0
}$$ 	
public%% 
bool%% 
AddAirLines%% 
(%%  
AirlineViewModel%%  0
airline%%1 8
)%%8 9
{&& 	
var'' 
airlineApiModel'' 
=''  !
_mapper''" )
.'') *
Map''* -
<''- .
AirLineApiModel''. =
>''= >
(''> ?
airline''? F
)''F G
;''G H
var)) 
data)) 
=)) 
JsonConvert)) "
.))" #
SerializeObject))# 2
())2 3
airlineApiModel))3 B
)))B C
;))C D
var** 
contentData** 
=** 
new** !
StringContent**" /
(**/ 0
data**0 4
,**4 5
System**6 <
.**< =
Text**= A
.**A B
Encoding**B J
.**J K
UTF8**K O
,**O P
$str**Q c
)**c d
;**d e
HttpResponseMessage++ 
response++  (
=++) *

httpClient+++ 5
.++5 6
	PostAsync++6 ?
(++? @
baseAddress++@ K
+++L M
$str++N g
,++g h
contentData++i t
)++t u
.++u v
Result++v |
;++| }
if,, 
(,, 
response,, 
.,, 
IsSuccessStatusCode,, ,
),,, -
{-- 
return.. 
true.. 
;.. 
}// 
else00 
{11 
return22 
false22 
;22 
}33 
}44 	
public55 
AirlineViewModel55  
GetById55! (
(55( )
int55) ,
?55, -
id55. 0
)550 1
{66 	
HttpResponseMessage77 
response77  (
=77) *

httpClient77, 6
.776 7
GetAsync777 ?
(77? @
baseAddress77@ K
+77L M
$str77N l
+77m n
id77o q
)77q r
.77r s
Result77s y
;77y z
string88 

stringData88 
=88 
response88  (
.88( )
Content88) 0
.880 1
ReadAsStringAsync881 B
(88B C
)88C D
.88D E
Result88E K
;88K L
AirLineApiModel99 
data99  
=99! "
JsonConvert99# .
.99. /
DeserializeObject99/ @
<99@ A
AirLineApiModel99A P
>99P Q
(99Q R

stringData99R \
)99\ ]
!99] ^
;99^ _
var:: 
airlines:: 
=:: 
_mapper:: "
.::" #
Map::# &
<::& '
AirlineViewModel::' 7
>::7 8
(::8 9
data::9 =
)::= >
;::> ?
return;; 
(;; 
airlines;; 
);; 
;;; 
}<< 	
public== 
bool== 
Update== 
(== 
AirlineViewModel== +
airlineViewModel==, <
)==< =
{>> 	
var?? 

airlineApi?? 
=?? 
_mapper?? $
.??$ %
Map??% (
<??( )
AirLineApiModel??) 8
>??8 9
(??9 :
airlineViewModel??: J
)??J K
;??K L
string@@ 

stringData@@ 
=@@ 
JsonConvert@@  +
.@@+ ,
SerializeObject@@, ;
(@@; <

airlineApi@@< F
)@@F G
;@@G H
varAA 
contentDataAA 
=AA 
newAA !
StringContentAA" /
(AA/ 0

stringDataAA0 :
,AA: ;
SystemAA< B
.AAB C
TextAAC G
.AAG H
EncodingAAH P
.AAP Q
UTF8AAQ U
,AAU V
$strAAW i
)AAi j
;AAj k
HttpResponseMessageBB 
responseBB  (
=BB) *

httpClientBB+ 5
.BB5 6
PutAsyncBB6 >
(BB> ?
baseAddressBB? J
+BBK L
$strBBM f
,BBf g
contentDataBBh s
)BBs t
.BBt u
ResultBBu {
;BB{ |
ifCC 
(CC 
responseCC 
.CC 
IsSuccessStatusCodeCC ,
)CC, -
{DD 
returnEE 
trueEE 
;EE 
}FF 
elseGG 
{HH 
returnII 
falseII 
;II 
}JJ 
}KK 	
}MM 
}NN 